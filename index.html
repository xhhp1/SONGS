<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pick Files / Folder ‚Äì Music Player</title>
<style>
  :root{--bg:#0f1115;--panel:#171a21;--text:#e6e6e6;--muted:#9aa4b2;--brand:#4da3ff;--radius:16px}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(80% 120% at 20% 10%, #1a2030 0%, #0c0f14 60%, #06070a 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .player{max-width:980px;margin:clamp(12px,4vw,36px) auto;padding:clamp(12px,3vw,24px);background:#141820;border:1px solid #222a;border-radius:var(--radius);box-shadow:0 10px 40px #0008,inset 0 1px 0 #fff1}
  .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
  .pickers{display:flex;gap:10px;flex-wrap:wrap}
  .pickers button{background:#0f172a;border:1px solid #243148;color:#cfe9ff;padding:8px 12px;border-radius:10px;cursor:pointer}
  .drop{border:2px dashed #2a3242;border-radius:12px;padding:12px;text-align:center;color:#bcd;opacity:.9}
  .drop.drag{border-color:#4da3ff;opacity:1}
  .now{display:grid;grid-template-columns:120px 1fr;gap:16px;align-items:center;margin-top:12px}
  .cover{width:120px;height:120px;border-radius:12px;background:linear-gradient(135deg,#333,#111);border:1px solid #000;box-shadow:inset 0 0 30px #0008,0 8px 24px #0009}
  .meta h1{margin:0 0 6px;font-size:clamp(18px,3vw,28px);font-weight:700}
  .meta p{margin:0;color:var(--muted)}
  .controls{margin-top:18px;display:grid;gap:12px}
  .buttons{display:flex;gap:10px;align-items:center}
  .buttons button{background:#0d1117;border:1px solid #263244;color:var(--text);border-radius:999px;padding:10px 14px;cursor:pointer;transition:transform .1s,background .2s,border-color .2s}
  .buttons button:hover{transform:translateY(-1px);background:#111827;border-color:#2b3b52}
  .buttons #btn-play{font-size:20px;padding:10px 16px;background:linear-gradient(180deg,#1a2333,#0d1422);border-color:#31425a}
  .seek{display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center}
  input[type=range]{-webkit-appearance:none;appearance:none;height:6px;border-radius:999px;background:#2a3344;outline:none}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--brand);border:2px solid #fff3;box-shadow:0 1px 4px #0008}
  .volume{display:flex;gap:10px;align-items:center}
  .playlist{margin-top:16px}
  .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px}
  .search{flex:1;display:flex;gap:8px}
  .search input{flex:1;min-width:160px;padding:8px 10px;border-radius:8px;border:1px solid #243148;background:#0d111a;color:#dfe9ff}
  .search small{color:#8aa4c2}
  ul#list{list-style:none;padding:0;margin:8px 0 0;border-top:1px dashed #2a3242}
  li.track{display:grid;grid-template-columns:32px 1fr 88px;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed #2a3242}
  li.track .idx{color:#7c8aa0;font-variant-numeric:tabular-nums}
  li.track .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  li.track .dur{color:#9eb0c7;text-align:right}
  li.track.active{background:linear-gradient(90deg,#18213466,transparent);border-radius:8px}
  @media (max-width:560px){.now{grid-template-columns:80px 1fr}.cover{width:80px;height:80px}li.track{grid-template-columns:24px 1fr 64px}}
</style>
</head>
<body>
  <main class="player">
    <div class="topbar">
      <div class="pickers">
        <input type="file" id="pickFiles" accept="audio/*,video/mp4" multiple hidden />
        <input type="file" id="pickFolder" accept="audio/*,video/mp4" webkitdirectory hidden />
        <button id="btnFiles">Ôºã Add Files</button>
        <button id="btnFolder">üìÅ Add Folder</button>
        <button id="btnClear" title="Clear current playlist">üóëÔ∏è Clear</button>
      </div>
      <div class="drop" id="drop">Drag & drop files or a folder here</div>
    </div>

    <section class="now">
      <div class="cover" id="cover" aria-hidden="true"></div>
      <div class="meta">
        <h1 id="title">‚Äî</h1>
        <p id="artist">Choose files or a folder to start</p>
      </div>
    </section>

    <section class="controls">
      <div class="buttons">
        <button id="btn-shuffle" title="Shuffle (S)">üîÄ</button>
        <button id="btn-prev" title="Previous (‚Üê)">‚èÆÔ∏è</button>
        <button id="btn-play" title="Play/Pause (Space)">‚ñ∂Ô∏è</button>
        <button id="btn-next" title="Next (‚Üí)">‚è≠Ô∏è</button>
        <button id="btn-repeat" title="Repeat (R)">üîÅ</button>
      </div>

      <div class="seek">
        <span id="current">0:00</span>
        <input type="range" id="seek" min="0" max="100" step="0.1" value="0" />
        <span id="duration">0:00</span>
      </div>

      <div class="volume">
        <button id="btn-mute" title="Mute (M)">üîä</button>
        <input type="range" id="vol" min="0" max="1" step="0.01" value="1" />
      </div>
    </section>

    <section class="playlist">
      <div class="toolbar">
        <h3 style="margin:0">Playlist</h3>
        <div class="search">
          <input id="search" placeholder="Search by name‚Ä¶" />
          <small id="count">0 items</small>
        </div>
      </div>
      <ul id="list" aria-label="Song list"></ul>
    </section>
  </main>

  <!-- Hidden media elements (mp4 uses <video> but stays invisible) -->
  <audio id="audio" preload="metadata"></audio>
  <video id="video" preload="metadata" style="display:none"></video>

<script>
(() => {
  // Elements
  const audio = document.getElementById('audio');
  const video = document.getElementById('video');
  let media = audio; // active element
  const el = (id)=>document.getElementById(id);

  const btnFiles=el('btnFiles'), btnFolder=el('btnFolder'), btnClear=el('btnClear');
  const pickFiles=el('pickFiles'), pickFolder=el('pickFolder'), drop=el('drop');
  const btnPlay=el('btn-play'), btnPrev=el('btn-prev'), btnNext=el('btn-next');
  const btnShuffle=el('btn-shuffle'), btnRepeat=el('btn-repeat'), btnMute=el('btn-mute');
  const seek=el('seek'), vol=el('vol'), current=el('current'), duration=el('duration');
  const title=el('title'), artist=el('artist'), cover=el('cover');
  const list=el('list'), search=el('search'), count=el('count');

  // State
  let repeatMode='off', shuffleOn=false, userIsSeeking=false;
  let tracks=[]; // {title, src(URL or path), ext, file?}
  let index=-1;

  const AUDIO_EXTS = ['.mp3','.wav','.m4a','.ogg','.aac'];
  const VIDEO_AUDIO_EXTS = ['.mp4','.webm','.mkv']; // played via hidden <video>
  const ALL_EXTS = [...AUDIO_EXTS, ...VIDEO_AUDIO_EXTS];

  function extOf(name=''){ const m = name.toLowerCase().match(/\.[^.]+$/); return m?m[0]:''; }
  function isAudioCandidate(fileOrName){
    const e = typeof fileOrName==='string' ? extOf(fileOrName) : extOf(fileOrName.name);
    return ALL_EXTS.includes(e);
  }
  const fmtTime = s => !isFinite(s) ? '0:00' : `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;

  function clearPlaylist(){
    // Revoke object URLs to avoid memory leaks
    tracks.forEach(t => t.url && URL.revokeObjectURL(t.url));
    tracks = []; index = -1;
    renderList(); updateCounts();
    title.textContent = '‚Äî';
    artist.textContent = 'Choose files or a folder to start';
    cover.style.background = 'linear-gradient(135deg,#333,#111)';
    pause();
    audio.removeAttribute('src'); video.removeAttribute('src');
    seek.value = 0; current.textContent='0:00'; duration.textContent='0:00';
  }

  function updateCounts(){
    const visible = list.querySelectorAll('li.track:not([hidden])').length;
    count.textContent = `${visible} item${visible!==1?'s':''}`;
  }

  function addFilesLikeList(fileList){
    const newOnes = [];
    for (const f of fileList){
      if (!isAudioCandidate(f)) continue;
      const url = URL.createObjectURL(f);
      const title = (f.webkitRelativePath || f.name).replace(/^.*[\\/]/,'').replace(/\.[^.]+$/,'');
      newOnes.push({ title, src:url, url, ext: extOf(f.name), file:f });
    }
    tracks.push(...newOnes);
    renderList();
    updateCounts();
    if (index === -1 && tracks.length){ load(0); }
  }

  // Render playlist
  function renderList(){
    list.innerHTML = '';
    tracks.forEach((t,i)=>{
      const li = document.createElement('li');
      li.className = 'track' + (i===index?' active':'');
      li.dataset.idx = i;
      li.innerHTML = `
        <span class="idx">${String(i+1).padStart(2,'0')}</span>
        <span class="name">${t.title}</span>
        <span class="dur">--:--</span>
      `;
      li.addEventListener('click', ()=>{ load(i); play(); });
      list.appendChild(li);
      // Preload duration quietly
      const probe = document.createElement( VIDEO_AUDIO_EXTS.includes(t.ext)? 'video' : 'audio' );
      probe.preload = 'metadata'; probe.src = t.src;
      probe.addEventListener('loadedmetadata', ()=>{
        const d = li.querySelector('.dur'); if (d) d.textContent = fmtTime(probe.duration);
      }, { once:true });
    });
    filterList(); // apply current search
  }

  function filterList(){
    const q = search.value.trim().toLowerCase();
    [...list.children].forEach(li=>{
      const name = li.querySelector('.name').textContent.toLowerCase();
      li.hidden = q && !name.includes(q);
    });
    updateCounts();
  }

  function useMediaFor(ext){
    // choose which element will handle playback
    if (VIDEO_AUDIO_EXTS.includes(ext)) { media = video; video.style.display='none'; }
    else { media = audio; }
  }

  function load(i){
    if (i<0 || i>=tracks.length) return;
    index = i;
    const t = tracks[index];
    pause(); // stop both
    useMediaFor(t.ext);
    audio.pause(); video.pause();
    audio.removeAttribute('src'); video.removeAttribute('src');
    media.src = t.src;

    title.textContent = t.title || 'Untitled';
    artist.textContent = t.file?.webkitRelativePath ? t.file.webkitRelativePath.split('/')[0] : '';
    cover.style.background = 'linear-gradient(135deg,#333,#111)';

    // highlight active
    [...list.children].forEach((li,idx)=>li.classList.toggle('active', idx===index));
  }

  function play(){ if (index<0 && tracks.length){ load(0); } media.play(); btnPlay.textContent='‚è∏Ô∏è'; }
  function pause(){ media.pause(); btnPlay.textContent='‚ñ∂Ô∏è'; }

  function next(){
    if (!tracks.length) return;
    if (shuffleOn){
      let r; do { r = Math.floor(Math.random()*tracks.length); } while (tracks.length>1 && r===index);
      load(r);
    } else {
      load((index+1) % tracks.length);
    }
    play();
  }
  function prev(){ if (!tracks.length) return; load((index-1+tracks.length)%tracks.length); play(); }

  // Events wiring
  btnFiles.onclick = ()=> pickFiles.click();
  btnFolder.onclick = ()=> pickFolder.click();
  btnClear.onclick = clearPlaylist;

  pickFiles.onchange = e => addFilesLikeList(e.target.files);
  pickFolder.onchange = e => addFilesLikeList(e.target.files); // webkitdirectory gives all files

  // Drag & drop (files or a folder)
  ;['dragenter','dragover'].forEach(evt=>{
    drop.addEventListener(evt, e=>{ e.preventDefault(); e.dataTransfer.dropEffect='copy'; drop.classList.add('drag'); });
  });
  ;['dragleave','drop'].forEach(evt=>{
    drop.addEventListener(evt, e=>{ e.preventDefault(); drop.classList.remove('drag'); });
  });
  drop.addEventListener('drop', e=>{
    const items = e.dataTransfer.items;
    if (items && items[0] && items[0].webkitGetAsEntry){
      // folder-aware (Chrome/Edge)
      const entries = [...items].map(it=>it.webkitGetAsEntry()).filter(Boolean);
      const files = [];
      let pending = 0;
      function readEntry(entry, path=''){
        if (entry.isFile){
          pending++;
          entry.file(file=>{ file.webkitRelativePath = path + file.name; files.push(file); if (!--pending) addFilesLikeList(files); });
        } else if (entry.isDirectory){
          const reader = entry.createReader();
          pending++;
          reader.readEntries(ents=>{
            ents.forEach(en=>readEntry(en, path + entry.name + '/'));
            if (!--pending) addFilesLikeList(files);
          });
        }
      }
      entries.forEach(en=>readEntry(en));
    } else {
      // fallback: plain files
      addFilesLikeList(e.dataTransfer.files);
    }
  });

  // Transport / controls
  btnPlay.onclick = ()=> media.paused ? play() : pause();
  btnPrev.onclick = prev; btnNext.onclick = next;
  btnMute.onclick = ()=>{ media.muted = !media.muted; btnMute.textContent = media.muted ? 'üîá' : 'üîä'; };
  btnShuffle.onclick = ()=>{ shuffleOn = !shuffleOn; btnShuffle.classList.toggle('on', shuffleOn); };
  btnRepeat.onclick = ()=>{
    repeatMode = repeatMode==='off' ? 'one' : repeatMode==='one' ? 'all' : 'off';
    btnRepeat.title = `Repeat (${repeatMode})`;
    media.loop = (repeatMode==='one');
  };

  vol.oninput = ()=>{ audio.volume = +vol.value; video.volume = +vol.value; };
  seek.addEventListener('input', ()=> userIsSeeking = true);
  seek.addEventListener('change', ()=>{
    const pos = (seek.value/100) * (media.duration || 0);
    media.currentTime = pos; userIsSeeking = false;
  });

  function hook(el){
    el.addEventListener('loadedmetadata', ()=>{
      duration.textContent = fmtTime(el.duration);
      // update per-item duration in list
      if (index>=0){
        const li = list.children[index];
        if (li) li.querySelector('.dur').textContent = fmtTime(el.duration);
      }
    });
    el.addEventListener('timeupdate', ()=>{
      if (!userIsSeeking && isFinite(el.duration)){
        seek.value = (el.currentTime / el.duration) * 100 || 0;
      }
      current.textContent = fmtTime(el.currentTime);
    });
    el.addEventListener('ended', ()=>{
      if (repeatMode==='one'){ play(); return; }
      if (repeatMode==='all' || index < tracks.length-1){ next(); } else { pause(); }
    });
  }
  hook(audio); hook(video);

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if (['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
    if (e.code==='Space'){ e.preventDefault(); media.paused ? play() : pause(); }
    else if (e.key==='ArrowRight'){ next(); }
    else if (e.key==='ArrowLeft'){ prev(); }
    else if (e.key.toLowerCase()==='m'){ media.muted = !media.muted; btnMute.textContent = media.muted ? 'üîá' : 'üîä'; }
    else if (e.key.toLowerCase()==='s'){ btnShuffle.click(); }
    else if (e.key.toLowerCase()==='r'){ btnRepeat.click(); }
    else if (e.key.toLowerCase()==='l'){ // jump to currently playing
      if (index>=0){ const li=list.children[index]; li?.scrollIntoView({behavior:'smooth',block:'center'}); }
    }
  });

  // Search filter
  search.addEventListener('input', filterList);
})();
</script>
</body>
</html>

